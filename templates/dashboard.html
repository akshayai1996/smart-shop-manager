{% extends "base.html" %}

{% block title %}Dashboard - ShopEase{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="fas fa-tachometer-alt"></i> Dashboard</h1>
    <div class="date-display">{{ datetime.now().strftime('%A, %d %B %Y') }}</div>
</div>

<style>
    .cards {
        display: grid;
        grid-template-columns: repeat(4, 1fr) !important;
        gap: 20px;
        margin-bottom: 30px;
    }
    @media (max-width: 1200px) {
        .cards {
            grid-template-columns: repeat(2, 1fr) !important;
        }
    }
    @media (max-width: 768px) {
        .cards {
            grid-template-columns: 1fr !important;
        }
    }
</style>

<div class="cards">
    <div class="card">
        <div class="card-icon"><i class="fas fa-cash-register"></i></div>
        <div class="card-info">
            <h3>Today's Sales</h3>
            <p class="big-number">₹{{ "{:,.0f}".format(total_today) }}</p>
        </div>
    </div>
    
    <div class="card">
        <div class="card-icon"><i class="fas fa-calendar-alt"></i></div>
        <div class="card-info">
            <h3>This Month</h3>
            <p class="big-number">₹{{ "{:,.0f}".format(total_month) }}</p>
        </div>
    </div>
    
    <div class="card">
        <div class="card-icon"><i class="fas fa-boxes"></i></div>
        <div class="card-info">
            <h3>Total Products</h3>
            <p class="big-number">{{ total_products }}</p>
        </div>
    </div>
    
    <div class="card {{ 'warning' if low_stock > 0 else '' }}">
        <div class="card-icon"><i class="fas fa-exclamation-triangle"></i></div>
        <div class="card-info">
            <h3>Low Stock</h3>
            <p class="big-number">{{ low_stock }}</p>
        </div>
    </div>
</div>

<div class="card mt-30 p-20">
    <!-- Chart Section -->
    <div class="section-header">
        <h2><i class="fas fa-chart-area"></i> Sales Trend (Last 30 Days)</h2>
    </div>
    <div class="chart-container-dashboard" style="height: 300px; width: 100%;">
        <canvas id="dashboardChart"></canvas>
    </div>
</div>

<div class="mt-30">
    <!-- Top Products -->
    <div class="card">
        <div class="section-header">
            <h2><i class="fas fa-crown"></i> Top Products</h2>
        </div>
        <div class="table-responsive">
            <table class="styled-table">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Sold</th>
                        <th>Revenue</th>
                    </tr>
                </thead>
                <tbody>
                    {% for product in top_products %}
                    <tr>
                        <td>{{ product.name }}</td>
                        <td>{{ product.quantity }}</td>
                        <td class="amount">₹{{ "{:,.0f}".format(product.revenue) }}</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="3" class="text-center">No data available</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    const ctx = document.getElementById('dashboardChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: {{ daily_labels|tojson }},
            datasets: [{
                label: 'Sales',
                data: {{ daily_data|tojson }},
                borderColor: '#667eea',
                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                borderWidth: 2,
                tension: 0.4,
                fill: true,
                pointRadius: 0,
                pointHoverRadius: 5
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: { borderDash: [5, 5] }
                },
                x: {
                    grid: { display: false }
                }
            }
        }
    });
</script>
{% endblock %}