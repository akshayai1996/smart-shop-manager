{% extends "base.html" %}
{% block title %}Customer Database - ShopEase{% endblock %}
{% block content %}

<div style="padding: 20px;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:25px;">
        <div>
            <h1 style="margin:0; color:#2d3748;"><i class="fas fa-users"></i> Customer Database</h1>
            <p style="margin:4px 0 0; color:#718096;">All customers, order history & cumulative business</p>
        </div>
    </div>

    <!-- Summary Cards -->
    <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:20px; margin-bottom:30px;">
        <div class="card" style="padding:20px; text-align:center;">
            <div style="font-size:36px; font-weight:700; color:#1a237e;">{{ total_customers }}</div>
            <div style="color:#718096; margin-top:5px;"><i class="fas fa-user-friends"></i> Total Customers</div>
        </div>
        <div class="card" style="padding:20px; text-align:center;">
            <div style="font-size:36px; font-weight:700; color:#2e7d32;">₹{{ "{:,.0f}".format(total_revenue) }}</div>
            <div style="color:#718096; margin-top:5px;"><i class="fas fa-rupee-sign"></i> Cumulative Revenue</div>
        </div>
        <div class="card" style="padding:20px; text-align:center;">
            {% if top_customer %}
            <div style="font-size:22px; font-weight:700; color:#e65100;">{{ top_customer.name }}</div>
            <div style="color:#718096; margin-top:5px;"><i class="fas fa-crown"></i> Top Customer (₹{{ "{:,.0f}".format(top_customer.total_spent) }})</div>
            {% endif %}
        </div>
    </div>

    <!-- Customer Table -->
    <div class="card">
        <div style="padding:15px 20px; border-bottom:1px solid #e2e8f0; display:flex; justify-content:space-between; align-items:center;">
            <h3 style="margin:0;">All Customers</h3>
            <input type="text" id="searchInput" placeholder="Search by name or phone..." onkeyup="filterTable()"
                   style="padding:8px 12px; border:1px solid #e2e8f0; border-radius:6px; width:250px;">
        </div>
        <div style="overflow-x:auto; overflow-y:auto; max-height:520px;">
            <table id="customerTable" style="width:100%; border-collapse:collapse;">
                <thead>
                    <tr style="background:#f7fafc;">
                        <th style="padding:12px 15px; text-align:left; color:#4a5568; font-size:12px; text-transform:uppercase; letter-spacing:1px;">#</th>
                        <th style="padding:12px 15px; text-align:left; color:#4a5568; font-size:12px; text-transform:uppercase; letter-spacing:1px;">Customer</th>
                        <th style="padding:12px 15px; text-align:left; color:#4a5568; font-size:12px; text-transform:uppercase; letter-spacing:1px;">Phone</th>
                        <th style="padding:12px 15px; text-align:center; color:#4a5568; font-size:12px; text-transform:uppercase; letter-spacing:1px;">Orders</th>
                        <th style="padding:12px 15px; text-align:right; color:#4a5568; font-size:12px; text-transform:uppercase; letter-spacing:1px;">Total Spent</th>
                        <th style="padding:12px 15px; text-align:left; color:#4a5568; font-size:12px; text-transform:uppercase; letter-spacing:1px;">Last Invoice</th>
                        <th style="padding:12px 15px; text-align:left; color:#4a5568; font-size:12px; text-transform:uppercase; letter-spacing:1px;">Last Visit</th>
                    </tr>
                </thead>
                <tbody>
                    {% for c in customers | sort(attribute='total_spent', reverse=True) %}
                    <tr style="border-bottom:1px solid #f0f0f0;" onmouseover="this.style.background='#f7fafc'" onmouseout="this.style.background='white'">
                        <td style="padding:13px 15px; color:#a0aec0;">{{ loop.index }}</td>
                        <td style="padding:13px 15px;">
                            <div style="font-weight:600; color:#2d3748;">{{ c.name }}</div>
                        </td>
                        <td style="padding:13px 15px; color:#718096;">{{ c.phone }}</td>
                        <td style="padding:13px 15px; text-align:center;">
                            <span style="background:#ebf8ff; color:#2b6cb0; padding:3px 10px; border-radius:12px; font-weight:600; font-size:13px;">{{ c.orders }}</span>
                        </td>
                        <td style="padding:13px 15px; text-align:right; font-weight:700; color:#2e7d32;">₹{{ "{:,.2f}".format(c.total_spent) }}</td>
                        <td style="padding:13px 15px; color:#718096; font-size:13px;">{{ c.last_invoice }}</td>
                        <td style="padding:13px 15px; color:#718096; font-size:13px;">{{ c.last_visit }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
function filterTable() {
    const input = document.getElementById('searchInput').value.toLowerCase();
    const rows = document.querySelectorAll('#customerTable tbody tr');
    rows.forEach(row => {
        const text = row.innerText.toLowerCase();
        row.style.display = text.includes(input) ? '' : 'none';
    });
}
</script>
{% endblock %}
